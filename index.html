<!--
    1. Create a website using HTML and host locally using VSCode's Live Server extension.
    2. Integrate APIs built in R (plumber), Python (flask), and JavaScript (express).
    3. Enable each API to interact with a local instance of a Microsoft SQL Server datase.
    4. Upon button click, each API writes a different record to the database.
    5. Current database table is displayed in the browser.
-->   

<body style="padding: 0 15%; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh;">
    <table style="table-layout: fixed; width: 100%;">
        <tr height = "20px">
            <h1>Project Connect</h1>
        </tr>
        <tr height = "200px">
            <td style="width: 33.33%; text-align: center;">
                <img src="images/r.png" height="80px">
                <br><br>
                <button id="button-r" style = "width: 150px; height: 30px;">R is the best!</button>
            </td>
            <td style="width: 33.33%; text-align: center;">
                <img src="images/python.png" height="80px">
                <br><br>
                <button id="button-py" style = "width: 150px; height: 30px;">Python is the best!</button>
            </td>
            <td style="width: 33.33%; text-align: center;">
                <img src="images/javascript.png" height="80px">
                <br><br>
                <button id="button-js" style = "width: 150px; height: 30px;">JavaScript is the best!</button>
            </td>
        </tr>
        <tr height = "20px"></tr>
        <tr height = "300px">
            <td id = "output-table-r" style = "width: 33.33%; text-align: center;">
                <!-- Display database table here -->
                <p>Data output from R's API</p>
            </td>
            <td id = "output-table-py" style = "width: 33.33%; text-align: center;">
                <!-- Display database table here -->
                <p>Data output from Python's API</p>
            </td>
            <td id = "output-table-js" style = "width: 33.33%; text-align: center;">
                <!-- Display database table here -->
                <p>Data output from JavaScript's API</p>
            </td>
        </tr>
    </table>

    <script>
        // Function to handle button clicks for API message
        function handleButtonClick(apiEndpoint, outputElementData) {
            fetch(apiEndpoint, {
                method: 'POST',
            })
                .then(response => response.json())
                .then(data => {
                    // Call displayData to refresh the table after new row is added
                    displayData('http://localhost:8000/api-r', outputElementData);
                })
                .catch(error => {
                    cosole.error('Error', error);
                })
        }

        // Function to automatically fetch and display data.data
        function displayData(apiEndpoint, outputElementData) {
            fetch(apiEndpoint)
                .then(response => response.json())
                .then(data => {
                    if(Array.isArray(data.data)){
                        const formattedData = data.data.join('<br>');
                        document.getElementById(outputElementData).innerHTML = formattedData;
                    } else {
                        document.getElementById(outputElementData).innerText = data.data;
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }
    
        // Event listeners for button clicks
        document.getElementById('button-r').addEventListener('click', () => handleButtonClick('http://localhost:8000/api-r', 'output-table-r'));        
        document.getElementById('button-py').addEventListener('click', () => handleButtonClick('http://127.0.0.1:5000/api-py', 'output-table-py'));
        document.getElementById('button-js').addEventListener('click', () => handleButtonClick('http://localhost:8000/javascript-api-endpoint', 'output-table-js'));
        
        // Display database table data from each API in real-time
        displayData('http://localhost:8000/api-r', 'output-table-r');
        displayData('http://127.0.0.1:5000/api-py', 'output-table-py');
        displayData('http://localhost:8000/javascript-api-endpoint', 'output-table-js');

    </script>

</body>